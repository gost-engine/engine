diff --git a/openssl/crypto/asn1/charmap.h b/openssl/crypto/asn1/charmap.h
index ac1eb076cc2..e7ac77d88ce 100644
--- a/openssl/crypto/asn1/charmap.h
+++ b/openssl/crypto/asn1/charmap.h
@@ -2,7 +2,7 @@
  * WARNING: do not edit!
  * Generated by crypto/asn1/charmap.pl
  *
- * Copyright 2000-2021 The OpenSSL Project Authors. All Rights Reserved.
+ * Copyright 2000-2025 The OpenSSL Project Authors. All Rights Reserved.
  *
  * Licensed under the Apache License 2.0 (the "License").  You may not use
  * this file except in compliance with the License.  You can obtain a copy
diff --git a/openssl/crypto/bn/bn_prime.h b/openssl/crypto/bn/bn_prime.h
index 8a859ac02e2..3a59f58afb7 100644
--- a/openssl/crypto/bn/bn_prime.h
+++ b/openssl/crypto/bn/bn_prime.h
@@ -2,7 +2,7 @@
  * WARNING: do not edit!
  * Generated by crypto/bn/bn_prime.pl
  *
- * Copyright 1998-2021 The OpenSSL Project Authors. All Rights Reserved.
+ * Copyright 1998-2025 The OpenSSL Project Authors. All Rights Reserved.
  *
  * Licensed under the Apache License 2.0 (the "License").  You may not use
  * this file except in compliance with the License.  You can obtain a copy
diff --git a/openssl/crypto/conf/conf_def.h b/openssl/crypto/conf/conf_def.h
index 1f66a58e092..62d4fa2b8c4 100644
--- a/openssl/crypto/conf/conf_def.h
+++ b/openssl/crypto/conf/conf_def.h
@@ -2,7 +2,7 @@
  * WARNING: do not edit!
  * Generated by crypto/conf/keysets.pl
  *
- * Copyright 1995-2021 The OpenSSL Project Authors. All Rights Reserved.
+ * Copyright 1995-2025 The OpenSSL Project Authors. All Rights Reserved.
  * Licensed under the Apache License 2.0 (the "License").  You may not use
  * this file except in compliance with the License.  You can obtain a copy
  * in the file LICENSE in the source distribution or at
diff --git a/openssl/crypto/evp/evp_enc.c b/openssl/crypto/evp/evp_enc.c
index bcc507edfdc..cd08cee82b0 100644
--- a/openssl/crypto/evp/evp_enc.c
+++ b/openssl/crypto/evp/evp_enc.c
@@ -1614,6 +1614,14 @@ int EVP_CIPHER_CTX_ctrl(EVP_CIPHER_CTX *ctx, int type, int arg, void *ptr)
         params[0] = OSSL_PARAM_construct_octet_string(
                 OSSL_CIPHER_PARAM_AEAD_MAC_KEY, ptr, sz);
         break;
+    case EVP_CTRL_TLSTREE:
+        params[0] = OSSL_PARAM_construct_octet_string(OSSL_CIPHER_PARAM_TLSTREE, ptr, sz);
+        params[1] = OSSL_PARAM_construct_end();
+        break;
+    case EVP_CTRL_SET_TLSTREE_PARAMS:
+        params[0] = OSSL_PARAM_construct_octet_string(OSSL_CIPHER_PARAM_TLSTREE_MODE, ptr, sz);
+        params[1] = OSSL_PARAM_construct_end();
+        break;
     }
 
     if (set_params)
diff --git a/openssl/crypto/objects/obj_dat.h b/openssl/crypto/objects/obj_dat.h
index 40d6f9ca4d1..38f1d346f35 100644
--- a/openssl/crypto/objects/obj_dat.h
+++ b/openssl/crypto/objects/obj_dat.h
@@ -10,7 +10,7 @@
  */
 
 /* Serialized OID's */
-static const unsigned char so[9571] = {
+static const unsigned char so[9589] = {
     0x2A,0x86,0x48,0x86,0xF7,0x0D,                 /* [    0] OBJ_rsadsi */
     0x2A,0x86,0x48,0x86,0xF7,0x0D,0x01,            /* [    6] OBJ_pkcs */
     0x2A,0x86,0x48,0x86,0xF7,0x0D,0x02,0x02,       /* [   13] OBJ_md2 */
@@ -1353,9 +1353,11 @@ static const unsigned char so[9571] = {
     0x2A,0x86,0x48,0x86,0xF7,0x0D,0x01,0x09,0x10,0x03,0x1E,  /* [ 9538] OBJ_HKDF_SHA512 */
     0x2A,0x86,0x48,0x86,0xF7,0x0D,0x01,0x09,0x10,0x0D,  /* [ 9549] OBJ_id_smime_ori */
     0x2A,0x86,0x48,0x86,0xF7,0x0D,0x01,0x09,0x10,0x0D,0x03,  /* [ 9559] OBJ_id_smime_ori_kem */
+    0x2A,0x85,0x03,0x07,0x01,0x01,0x05,0x01,0x03,  /* [ 9570] OBJ_magma_mgm */
+    0x2A,0x85,0x03,0x07,0x01,0x01,0x05,0x02,0x03,  /* [ 9579] OBJ_kuznyechik_mgm */
 };
 
-#define NUM_NID 1501
+#define NUM_NID 1503
 static const ASN1_OBJECT nid_objs[NUM_NID] = {
     {"UNDEF", "undefined", NID_undef},
     {"rsadsi", "RSA Data Security, Inc.", NID_rsadsi, 6, &so[0]},
@@ -2858,9 +2860,11 @@ static const ASN1_OBJECT nid_objs[NUM_NID] = {
     {"id-alg-hkdf-with-sha512", "HKDF-SHA512", NID_HKDF_SHA512, 11, &so[9538]},
     {"id-smime-ori", "id-smime-ori", NID_id_smime_ori, 10, &so[9549]},
     {"id-smime-ori-kem", "id-smime-ori-kem", NID_id_smime_ori_kem, 11, &so[9559]},
+    {"magma-mgm", "magma-mgm", NID_magma_mgm, 9, &so[9570]},
+    {"kuznyechik-mgm", "kuznyechik-mgm", NID_kuznyechik_mgm, 9, &so[9579]},
 };
 
-#define NUM_SN 1492
+#define NUM_SN 1494
 static const unsigned int sn_objs[NUM_SN] = {
      364,    /* "AD_DVCS" */
      419,    /* "AES-128-CBC" */
@@ -3823,6 +3827,7 @@ static const unsigned int sn_objs[NUM_SN] = {
     1012,    /* "kuznyechik-ecb" */
     1183,    /* "kuznyechik-kexp15" */
     1017,    /* "kuznyechik-mac" */
+    1502,    /* "kuznyechik-mgm" */
     1014,    /* "kuznyechik-ofb" */
      477,    /* "lastModifiedBy" */
      476,    /* "lastModifiedTime" */
@@ -3836,6 +3841,7 @@ static const unsigned int sn_objs[NUM_SN] = {
     1187,    /* "magma-ecb" */
     1181,    /* "magma-kexp15" */
     1192,    /* "magma-mac" */
+    1501,    /* "magma-mgm" */
     1189,    /* "magma-ofb" */
      460,    /* "mail" */
      493,    /* "mailPreferenceOption" */
@@ -4356,7 +4362,7 @@ static const unsigned int sn_objs[NUM_SN] = {
     1289,    /* "zstd" */
 };
 
-#define NUM_LN 1492
+#define NUM_LN 1494
 static const unsigned int ln_objs[NUM_LN] = {
      363,    /* "AD Time Stamping" */
      405,    /* "ANSI X9.62" */
@@ -5435,6 +5441,7 @@ static const unsigned int ln_objs[NUM_LN] = {
     1012,    /* "kuznyechik-ecb" */
     1183,    /* "kuznyechik-kexp15" */
     1017,    /* "kuznyechik-mac" */
+    1502,    /* "kuznyechik-mgm" */
     1014,    /* "kuznyechik-ofb" */
     1063,    /* "kx-any" */
     1039,    /* "kx-dhe" */
@@ -5460,6 +5467,7 @@ static const unsigned int ln_objs[NUM_LN] = {
     1187,    /* "magma-ecb" */
     1181,    /* "magma-kexp15" */
     1192,    /* "magma-mac" */
+    1501,    /* "magma-mgm" */
     1189,    /* "magma-ofb" */
      493,    /* "mailPreferenceOption" */
      467,    /* "manager" */
@@ -5852,7 +5860,7 @@ static const unsigned int ln_objs[NUM_LN] = {
      125,    /* "zlib compression" */
 };
 
-#define NUM_OBJ 1349
+#define NUM_OBJ 1351
 static const unsigned int obj_objs[NUM_OBJ] = {
        0,    /* OBJ_undef                        0 */
      181,    /* OBJ_iso                          1 */
@@ -6769,8 +6777,10 @@ static const unsigned int obj_objs[NUM_OBJ] = {
     1122,    /* OBJ_aria_256_ccm                 1 2 410 200046 1 1 39 */
     1174,    /* OBJ_magma_ctr_acpkm              1 2 643 7 1 1 5 1 1 */
     1175,    /* OBJ_magma_ctr_acpkm_omac         1 2 643 7 1 1 5 1 2 */
+    1501,    /* OBJ_magma_mgm                    1 2 643 7 1 1 5 1 3 */
     1177,    /* OBJ_kuznyechik_ctr_acpkm         1 2 643 7 1 1 5 2 1 */
     1178,    /* OBJ_kuznyechik_ctr_acpkm_omac    1 2 643 7 1 1 5 2 2 */
+    1502,    /* OBJ_kuznyechik_mgm               1 2 643 7 1 1 5 2 3 */
     1181,    /* OBJ_magma_kexp15                 1 2 643 7 1 1 7 1 1 */
     1183,    /* OBJ_kuznyechik_kexp15            1 2 643 7 1 1 7 2 1 */
     1148,    /* OBJ_id_tc26_gost_3410_2012_256_paramSetA 1 2 643 7 1 2 1 1 1 */
diff --git a/openssl/crypto/objects/obj_mac.num b/openssl/crypto/objects/obj_mac.num
index b48d054d329..c4d5c1b301a 100644
--- a/openssl/crypto/objects/obj_mac.num
+++ b/openssl/crypto/objects/obj_mac.num
@@ -1498,3 +1498,5 @@ HKDF_SHA384		1497
 HKDF_SHA512		1498
 id_smime_ori		1499
 id_smime_ori_kem		1500
+magma_mgm		1501
+kuznyechik_mgm		1502
diff --git a/openssl/crypto/objects/objects.txt b/openssl/crypto/objects/objects.txt
index feed79b6738..ddc5d651a92 100644
--- a/openssl/crypto/objects/objects.txt
+++ b/openssl/crypto/objects/objects.txt
@@ -1528,9 +1528,11 @@ id-tc26-algorithms 5	: id-tc26-cipher
 id-tc26-cipher 1	:  id-tc26-cipher-gostr3412-2015-magma
 id-tc26-cipher-gostr3412-2015-magma 1	: magma-ctr-acpkm
 id-tc26-cipher-gostr3412-2015-magma 2	: magma-ctr-acpkm-omac
+id-tc26-cipher-gostr3412-2015-magma 3   : magma-mgm
 id-tc26-cipher 2	:  id-tc26-cipher-gostr3412-2015-kuznyechik
 id-tc26-cipher-gostr3412-2015-kuznyechik 1	: kuznyechik-ctr-acpkm
 id-tc26-cipher-gostr3412-2015-kuznyechik 2	: kuznyechik-ctr-acpkm-omac
+id-tc26-cipher-gostr3412-2015-kuznyechik 3  : kuznyechik-mgm
 
 id-tc26-algorithms 6	: id-tc26-agreement
 id-tc26-agreement 1	: id-tc26-agreement-gost-3410-2012-256
diff --git a/openssl/fuzz/oids.txt b/openssl/fuzz/oids.txt
index b299cc2d64f..5c283a53cd0 100644
--- a/openssl/fuzz/oids.txt
+++ b/openssl/fuzz/oids.txt
@@ -1349,3 +1349,5 @@ OBJ_HKDF_SHA384="\x2A\x86\x48\x86\xF7\x0D\x01\x09\x10\x03\x1D"
 OBJ_HKDF_SHA512="\x2A\x86\x48\x86\xF7\x0D\x01\x09\x10\x03\x1E"
 OBJ_id_smime_ori="\x2A\x86\x48\x86\xF7\x0D\x01\x09\x10\x0D"
 OBJ_id_smime_ori_kem="\x2A\x86\x48\x86\xF7\x0D\x01\x09\x10\x0D\x03"
+OBJ_magma_mgm="\x2A\x85\x03\x07\x01\x01\x05\x01\x03"
+OBJ_kuznyechik_mgm="\x2A\x85\x03\x07\x01\x01\x05\x02\x03"
diff --git a/openssl/include/openssl/evp.h b/openssl/include/openssl/evp.h
index 61e50b266d6..a293e98215b 100644
--- a/openssl/include/openssl/evp.h
+++ b/openssl/include/openssl/evp.h
@@ -460,6 +460,7 @@ OSSL_DEPRECATEDIN_3_0 int
 #define          EVP_CTRL_GET_WRAP_CIPHER                0x29
 /* TLSTREE key diversification */
 #define          EVP_CTRL_TLSTREE                        0x2A
+# define          EVP_CTRL_SET_TLSTREE_PARAMS             0x2B
 
 /* Padding modes */
 #define EVP_PADDING_PKCS7       1
@@ -498,6 +499,10 @@ typedef struct {
 /* Length of CCM8 tag for TLS */
 # define EVP_CCM8_TLS_TAG_LEN                            8
 
+/* GOST TLS 1.3 tag lengths */
+# define EVP_MAGMA_TLS_TAG_LEN                           8
+# define EVP_KUZNYECHIK_TLS_TAG_LEN                      16
+
 /* Length of tag for TLS */
 # define EVP_CHACHAPOLY_TLS_TAG_LEN                      16
 
diff --git a/openssl/include/openssl/obj_mac.h b/openssl/include/openssl/obj_mac.h
index 440ec10df67..262cad65d31 100644
--- a/openssl/include/openssl/obj_mac.h
+++ b/openssl/include/openssl/obj_mac.h
@@ -4853,6 +4853,10 @@
 #define NID_magma_ctr_acpkm_omac                1175
 #define OBJ_magma_ctr_acpkm_omac                OBJ_id_tc26_cipher_gostr3412_2015_magma,2L
 
+#define SN_magma_mgm            "magma-mgm"
+#define NID_magma_mgm           1501
+#define OBJ_magma_mgm           OBJ_id_tc26_cipher_gostr3412_2015_magma,3L
+
 #define SN_id_tc26_cipher_gostr3412_2015_kuznyechik             "id-tc26-cipher-gostr3412-2015-kuznyechik"
 #define NID_id_tc26_cipher_gostr3412_2015_kuznyechik            1176
 #define OBJ_id_tc26_cipher_gostr3412_2015_kuznyechik            OBJ_id_tc26_cipher,2L
@@ -4865,6 +4869,10 @@
 #define NID_kuznyechik_ctr_acpkm_omac           1178
 #define OBJ_kuznyechik_ctr_acpkm_omac           OBJ_id_tc26_cipher_gostr3412_2015_kuznyechik,2L
 
+#define SN_kuznyechik_mgm               "kuznyechik-mgm"
+#define NID_kuznyechik_mgm              1502
+#define OBJ_kuznyechik_mgm              OBJ_id_tc26_cipher_gostr3412_2015_kuznyechik,3L
+
 #define SN_id_tc26_agreement            "id-tc26-agreement"
 #define NID_id_tc26_agreement           991
 #define OBJ_id_tc26_agreement           OBJ_id_tc26_algorithms,6L
diff --git a/openssl/include/openssl/tls1.h b/openssl/include/openssl/tls1.h
index 50910d0e4c0..7fe69992f19 100644
--- a/openssl/include/openssl/tls1.h
+++ b/openssl/include/openssl/tls1.h
@@ -664,6 +664,12 @@ int SSL_CTX_set_tlsext_ticket_key_evp_cb
 # define TLS1_CK_RSA_PSK_WITH_ARIA_128_GCM_SHA256         0x0300C06E
 # define TLS1_CK_RSA_PSK_WITH_ARIA_256_GCM_SHA384         0x0300C06F
 
+/* TLS1.3 GOST ciphersuites from RFC9367 */
+# define TLS1_3_CK_GOSTR341112_256_WITH_KUZNYECHIK_MGM_L        0x0300C103
+# define TLS1_3_CK_GOSTR341112_256_WITH_MAGMA_MGM_L             0x0300C104
+# define TLS1_3_CK_GOSTR341112_256_WITH_KUZNYECHIK_MGM_S        0x0300C105
+# define TLS1_3_CK_GOSTR341112_256_WITH_MAGMA_MGM_S             0x0300C106
+
 /* a bundle of RFC standard cipher names, generated from ssl3_ciphers[] */
 # define TLS1_RFC_RSA_WITH_AES_128_SHA                   "TLS_RSA_WITH_AES_128_CBC_SHA"
 # define TLS1_RFC_DHE_DSS_WITH_AES_128_SHA               "TLS_DHE_DSS_WITH_AES_128_CBC_SHA"
@@ -856,6 +862,10 @@ int SSL_CTX_set_tlsext_ticket_key_evp_cb
 # define TLS1_RFC_DHE_PSK_WITH_ARIA_256_GCM_SHA384       "TLS_DHE_PSK_WITH_ARIA_256_GCM_SHA384"
 # define TLS1_RFC_RSA_PSK_WITH_ARIA_128_GCM_SHA256       "TLS_RSA_PSK_WITH_ARIA_128_GCM_SHA256"
 # define TLS1_RFC_RSA_PSK_WITH_ARIA_256_GCM_SHA384       "TLS_RSA_PSK_WITH_ARIA_256_GCM_SHA384"
+# define TLS1_RFC_GOSTR341112_256_WITH_KUZNYECHIK_MGM_L  "TLS_GOSTR341112_256_WITH_KUZNYECHIK_MGM_L"
+# define TLS1_RFC_GOSTR341112_256_WITH_KUZNYECHIK_MGM_S  "TLS_GOSTR341112_256_WITH_KUZNYECHIK_MGM_S"
+# define TLS1_RFC_GOSTR341112_256_WITH_MAGMA_MGM_L       "TLS_GOSTR341112_256_WITH_MAGMA_MGM_L"
+# define TLS1_RFC_GOSTR341112_256_WITH_MAGMA_MGM_S       "TLS_GOSTR341112_256_WITH_MAGMA_MGM_S"
 
 
 /*
diff --git a/openssl/ssl/record/methods/recmethod_local.h b/openssl/ssl/record/methods/recmethod_local.h
index 364a3a01bbe..058a2c58123 100644
--- a/openssl/ssl/record/methods/recmethod_local.h
+++ b/openssl/ssl/record/methods/recmethod_local.h
@@ -332,7 +332,7 @@ struct ossl_record_layer_st {
 
     /* Flags for GOST ciphers */
     int stream_mac;
-    int tlstree;
+    uint32_t tlstree;
 
     /* TLSv1.3 fields */
     unsigned char *iv;     /* static IV */
diff --git a/openssl/ssl/record/methods/tls13_meth.c b/openssl/ssl/record/methods/tls13_meth.c
index c022d064a3e..8ec7d58cde0 100644
--- a/openssl/ssl/record/methods/tls13_meth.c
+++ b/openssl/ssl/record/methods/tls13_meth.c
@@ -78,6 +78,18 @@ static int tls13_set_crypto_state(OSSL_RECORD_LAYER *rl, int level,
         ERR_raise(ERR_LIB_SSL, ERR_R_INTERNAL_ERROR);
         return OSSL_RECORD_RETURN_FATAL;
     }
+
+    if (!rl->isdtls && rl->tlstree) {
+        int res = 0;
+
+        if (rl->tlstree & TLS1_TLSTREE_S)
+            res = EVP_CIPHER_CTX_ctrl(ciph_ctx, EVP_CTRL_SET_TLSTREE_PARAMS, 0, "strong");
+        else if (rl->tlstree & TLS1_TLSTREE_L)
+            res = EVP_CIPHER_CTX_ctrl(ciph_ctx, EVP_CTRL_SET_TLSTREE_PARAMS, 0, "light");
+
+        if (res <= 0)
+            return OSSL_RECORD_RETURN_FATAL;
+    }
  end:
     return OSSL_RECORD_RETURN_SUCCESS;
 }
@@ -162,6 +174,11 @@ static int tls13_cipher(OSSL_RECORD_LAYER *rl, TLS_RL_RECORD *recs,
     for (loop = 0; loop < SEQ_NUM_SIZE; loop++)
         nonce[offset + loop] = staticiv[offset + loop] ^ seq[loop];
 
+    if (!rl->isdtls && rl->tlstree && EVP_CIPHER_CTX_ctrl(enc_ctx, EVP_CTRL_TLSTREE, 0, seq) <= 0) {
+        RLAYERfatal(rl, SSL_AD_INTERNAL_ERROR, ERR_R_INTERNAL_ERROR);
+        return 0;
+    }
+
     if (!tls_increment_sequence_ctr(rl)) {
         /* RLAYERfatal already called */
         return 0;
diff --git a/openssl/ssl/record/methods/tls_common.c b/openssl/ssl/record/methods/tls_common.c
index 6ee265021c5..a15c6e06175 100644
--- a/openssl/ssl/record/methods/tls_common.c
+++ b/openssl/ssl/record/methods/tls_common.c
@@ -1302,7 +1302,7 @@ tls_int_new_record_layer(OSSL_LIB_CTX *libctx, const char *propq, int vers,
                 }
             } else if (strcmp(p->key,
                               OSSL_LIBSSL_RECORD_LAYER_PARAM_TLSTREE) == 0) {
-                if (!OSSL_PARAM_get_int(p, &rl->tlstree)) {
+                if (!OSSL_PARAM_get_uint32(p, &rl->tlstree)) {
                     ERR_raise(ERR_LIB_SSL, SSL_R_FAILED_TO_GET_PARAMETER);
                     goto err;
                 }
diff --git a/openssl/ssl/record/rec_layer_s3.c b/openssl/ssl/record/rec_layer_s3.c
index dac248fec8f..800a8d46fcd 100644
--- a/openssl/ssl/record/rec_layer_s3.c
+++ b/openssl/ssl/record/rec_layer_s3.c
@@ -1255,7 +1255,8 @@ int ssl_set_new_record_layer(SSL_CONNECTION *s, int version,
     BIO *thisbio;
     SSL_CTX *sctx = SSL_CONNECTION_GET_CTX(s);
     const OSSL_RECORD_METHOD *meth;
-    int use_etm, stream_mac = 0, tlstree = 0;
+    int use_etm, stream_mac = 0;
+    uint32_t algorithm2 = 0, tlstree = 0;
     unsigned int maxfrag = (direction == OSSL_RECORD_DIRECTION_WRITE)
                            ? ssl_get_max_send_fragment(s)
                            : SSL3_RT_MAX_PLAIN_LENGTH;
@@ -1318,6 +1319,14 @@ int ssl_set_new_record_layer(SSL_CONNECTION *s, int version,
             tlstree = 1;
     }
 
+    if (s->s3.tmp.new_cipher != NULL)
+        algorithm2 = s->s3.tmp.new_cipher->algorithm2;
+    else if (s->session != NULL && s->session->cipher != NULL)
+        algorithm2 = s->session->cipher->algorithm2;
+    else if (s->psksession != NULL && s->psksession->cipher != NULL)
+        algorithm2 = s->psksession->cipher->algorithm2;
+    tlstree |= (algorithm2 & TLS1_TLSTREE_L) | (algorithm2 & TLS1_TLSTREE_S);
+
     if (use_etm)
         *set++ = OSSL_PARAM_construct_int(OSSL_LIBSSL_RECORD_LAYER_PARAM_USE_ETM,
                                           &use_etm);
@@ -1327,8 +1336,8 @@ int ssl_set_new_record_layer(SSL_CONNECTION *s, int version,
                                           &stream_mac);
 
     if (tlstree)
-        *set++ = OSSL_PARAM_construct_int(OSSL_LIBSSL_RECORD_LAYER_PARAM_TLSTREE,
-                                          &tlstree);
+        *set++ = OSSL_PARAM_construct_uint32(OSSL_LIBSSL_RECORD_LAYER_PARAM_TLSTREE,
+                                             &tlstree);
 
     /*
      * We only need to do this for the read side. The write side should already
diff --git a/openssl/ssl/s3_lib.c b/openssl/ssl/s3_lib.c
index 226493a1615..55625589fd2 100644
--- a/openssl/ssl/s3_lib.c
+++ b/openssl/ssl/s3_lib.c
@@ -149,6 +149,72 @@ static SSL_CIPHER tls13_ciphers[] = {
         384,
     },
 #endif
+#ifndef OPENSSL_NO_GOST
+    {
+        1,
+        TLS1_RFC_GOSTR341112_256_WITH_KUZNYECHIK_MGM_L,
+        TLS1_RFC_GOSTR341112_256_WITH_KUZNYECHIK_MGM_L,
+        TLS1_3_CK_GOSTR341112_256_WITH_KUZNYECHIK_MGM_L,
+        SSL_kANY,
+        SSL_aANY,
+        SSL_KUZNYECHIK_MGM,
+        SSL_AEAD,
+        TLS1_3_VERSION, TLS1_3_VERSION,
+        0, 0,
+        SSL_HIGH,
+        SSL_HANDSHAKE_MAC_GOST12_256 | TLS1_PRF_GOST12_256 | TLS1_TLSTREE | TLS1_TLSTREE_L,
+        256,
+        256,
+    },
+    {
+        1,
+        TLS1_RFC_GOSTR341112_256_WITH_KUZNYECHIK_MGM_S,
+        TLS1_RFC_GOSTR341112_256_WITH_KUZNYECHIK_MGM_S,
+        TLS1_3_CK_GOSTR341112_256_WITH_KUZNYECHIK_MGM_S,
+        SSL_kANY,
+        SSL_aANY,
+        SSL_KUZNYECHIK_MGM,
+        SSL_AEAD,
+        TLS1_3_VERSION, TLS1_3_VERSION,
+        0, 0,
+        SSL_HIGH,
+        SSL_HANDSHAKE_MAC_GOST12_256 | TLS1_PRF_GOST12_256 | TLS1_TLSTREE | TLS1_TLSTREE_S,
+        256,
+        256,
+    },
+    {
+        1,
+        TLS1_RFC_GOSTR341112_256_WITH_MAGMA_MGM_L,
+        TLS1_RFC_GOSTR341112_256_WITH_MAGMA_MGM_L,
+        TLS1_3_CK_GOSTR341112_256_WITH_MAGMA_MGM_L,
+        SSL_kANY,
+        SSL_aANY,
+        SSL_MAGMA_MGM,
+        SSL_AEAD,
+        TLS1_3_VERSION, TLS1_3_VERSION,
+        0, 0,
+        SSL_HIGH,
+        SSL_HANDSHAKE_MAC_GOST12_256 | TLS1_PRF_GOST12_256 | TLS1_TLSTREE | TLS1_TLSTREE_L,
+        256,
+        256,
+    },
+    {
+        1,
+        TLS1_RFC_GOSTR341112_256_WITH_MAGMA_MGM_S,
+        TLS1_RFC_GOSTR341112_256_WITH_MAGMA_MGM_S,
+        TLS1_3_CK_GOSTR341112_256_WITH_MAGMA_MGM_S,
+        SSL_kANY,
+        SSL_aANY,
+        SSL_MAGMA_MGM,
+        SSL_AEAD,
+        TLS1_3_VERSION, TLS1_3_VERSION,
+        0, 0,
+        SSL_HIGH,
+        SSL_HANDSHAKE_MAC_GOST12_256 | TLS1_PRF_GOST12_256 | TLS1_TLSTREE | TLS1_TLSTREE_S,
+        256,
+        256,
+    },
+#endif
 };
 
 /*
diff --git a/openssl/ssl/ssl_ciph.c b/openssl/ssl/ssl_ciph.c
index 2c35f31065c..ee22dd4d95f 100644
--- a/openssl/ssl/ssl_ciph.c
+++ b/openssl/ssl/ssl_ciph.c
@@ -60,8 +60,10 @@ static const ssl_cipher_table ssl_cipher_table_cipher[SSL_ENC_NUM_IDX] = {
     {SSL_CHACHA20POLY1305, NID_chacha20_poly1305}, /* SSL_ENC_CHACHA_IDX 19 */
     {SSL_ARIA128GCM, NID_aria_128_gcm}, /* SSL_ENC_ARIA128GCM_IDX 20 */
     {SSL_ARIA256GCM, NID_aria_256_gcm}, /* SSL_ENC_ARIA256GCM_IDX 21 */
-    {SSL_MAGMA, NID_magma_ctr_acpkm}, /* SSL_ENC_MAGMA_IDX */
-    {SSL_KUZNYECHIK, NID_kuznyechik_ctr_acpkm}, /* SSL_ENC_KUZNYECHIK_IDX */
+    {SSL_MAGMA, NID_magma_ctr_acpkm}, /* SSL_ENC_MAGMA_IDX 22 */
+    {SSL_KUZNYECHIK, NID_kuznyechik_ctr_acpkm}, /* SSL_ENC_KUZNYECHIK_IDX 23 */
+    {SSL_MAGMA_MGM, NID_magma_mgm}, /* SSL_ENC_MAGMA_MGM_IDX 24 */
+    {SSL_KUZNYECHIK_MGM, NID_kuznyechik_mgm}, /* SSL_ENC_KUZNYECHIK_MGM_IDX 25 */
 };
 
 /* NB: make sure indices in this table matches values above */
@@ -323,6 +325,23 @@ static int get_optional_pkey_id(const char *pkey_name)
 }
 #endif
 
+/* Checks to see if algorithms are fetchable */
+#define IS_FETCHABLE(type, TYPE)                                         \
+    static int is_ ## type ## _fetchable(SSL_CTX *ctx, const char *name) \
+    {                                                                    \
+        TYPE *impl;                                                      \
+                                                                         \
+        ERR_set_mark();                                                  \
+        impl = TYPE ## _fetch(ctx->libctx, name, ctx->propq);            \
+        ERR_pop_to_mark();                                               \
+        if (impl == NULL)                                                \
+            return 0;                                                    \
+        TYPE ## _free(impl);                                             \
+        return 1;                                                        \
+    }
+
+IS_FETCHABLE(keymgmt, EVP_KEYMGMT)
+
 int ssl_load_ciphers(SSL_CTX *ctx)
 {
     size_t i;
@@ -431,11 +450,14 @@ int ssl_load_ciphers(SSL_CTX *ctx)
     else
         ctx->disabled_mac_mask |= SSL_KUZNYECHIKOMAC;
 
-    if (!get_optional_pkey_id(SN_id_GostR3410_2001))
+    if (!get_optional_pkey_id(SN_id_GostR3410_2001)
+        && !is_keymgmt_fetchable(ctx, SN_id_GostR3410_2001))
         ctx->disabled_auth_mask |= SSL_aGOST01 | SSL_aGOST12;
-    if (!get_optional_pkey_id(SN_id_GostR3410_2012_256))
+    if (!get_optional_pkey_id(SN_id_GostR3410_2012_256)
+        && !is_keymgmt_fetchable(ctx, SN_id_GostR3410_2012_256))
         ctx->disabled_auth_mask |= SSL_aGOST12;
-    if (!get_optional_pkey_id(SN_id_GostR3410_2012_512))
+    if (!get_optional_pkey_id(SN_id_GostR3410_2012_512)
+        && !is_keymgmt_fetchable(ctx, SN_id_GostR3410_2012_512))
         ctx->disabled_auth_mask |= SSL_aGOST12;
     /*
      * Disable GOST key exchange if no GOST signature algs are available *
@@ -1840,9 +1862,15 @@ char *SSL_CIPHER_description(const SSL_CIPHER *cipher, char *buf, int len)
     case SSL_MAGMA:
         enc = "MAGMA";
         break;
+    case SSL_MAGMA_MGM:
+        enc = "MAGMAMGM";
+        break;
     case SSL_KUZNYECHIK:
         enc = "KUZNYECHIK";
         break;
+    case SSL_KUZNYECHIK_MGM:
+        enc = "KUZNYECHIKMGM";
+        break;
     case SSL_CHACHA20POLY1305:
         enc = "CHACHA20/POLY1305(256)";
         break;
diff --git a/openssl/ssl/ssl_local.h b/openssl/ssl/ssl_local.h
index 104379e990b..eadb6e19cea 100644
--- a/openssl/ssl/ssl_local.h
+++ b/openssl/ssl/ssl_local.h
@@ -151,6 +151,8 @@
 # define SSL_ARIA256GCM          0x00200000U
 # define SSL_MAGMA               0x00400000U
 # define SSL_KUZNYECHIK          0x00800000U
+# define SSL_MAGMA_MGM           0x01000000U
+# define SSL_KUZNYECHIK_MGM      0x02000000U
 
 # define SSL_AESGCM              (SSL_AES128GCM | SSL_AES256GCM)
 # define SSL_AESCCM              (SSL_AES128CCM | SSL_AES256CCM | SSL_AES128CCM8 | SSL_AES256CCM8)
@@ -233,7 +235,9 @@
  * TLSTREE cipher/mac key derivation from draft-smyshlyaev-tls12-gost-suites
  * (currently this also  goes into algorithm2)
  */
-# define TLS1_TLSTREE 0x20000
+# define TLS1_TLSTREE    0x20000
+# define TLS1_TLSTREE_S  0x80000
+# define TLS1_TLSTREE_L  0x100000
 
 /* Ciphersuite supported in QUIC */
 # define SSL_QUIC                0x00040000U
@@ -328,31 +332,33 @@
 # define SSL_PKEY_ED448          8
 # define SSL_PKEY_NUM            9
 
-# define SSL_ENC_DES_IDX         0
-# define SSL_ENC_3DES_IDX        1
-# define SSL_ENC_RC4_IDX         2
-# define SSL_ENC_RC2_IDX         3
-# define SSL_ENC_IDEA_IDX        4
-# define SSL_ENC_NULL_IDX        5
-# define SSL_ENC_AES128_IDX      6
-# define SSL_ENC_AES256_IDX      7
-# define SSL_ENC_CAMELLIA128_IDX 8
-# define SSL_ENC_CAMELLIA256_IDX 9
-# define SSL_ENC_GOST89_IDX      10
-# define SSL_ENC_SEED_IDX        11
-# define SSL_ENC_AES128GCM_IDX   12
-# define SSL_ENC_AES256GCM_IDX   13
-# define SSL_ENC_AES128CCM_IDX   14
-# define SSL_ENC_AES256CCM_IDX   15
-# define SSL_ENC_AES128CCM8_IDX  16
-# define SSL_ENC_AES256CCM8_IDX  17
-# define SSL_ENC_GOST8912_IDX    18
-# define SSL_ENC_CHACHA_IDX      19
-# define SSL_ENC_ARIA128GCM_IDX  20
-# define SSL_ENC_ARIA256GCM_IDX  21
-# define SSL_ENC_MAGMA_IDX       22
-# define SSL_ENC_KUZNYECHIK_IDX  23
-# define SSL_ENC_NUM_IDX         24
+# define SSL_ENC_DES_IDX             0
+# define SSL_ENC_3DES_IDX            1
+# define SSL_ENC_RC4_IDX             2
+# define SSL_ENC_RC2_IDX             3
+# define SSL_ENC_IDEA_IDX            4
+# define SSL_ENC_NULL_IDX            5
+# define SSL_ENC_AES128_IDX          6
+# define SSL_ENC_AES256_IDX          7
+# define SSL_ENC_CAMELLIA128_IDX     8
+# define SSL_ENC_CAMELLIA256_IDX     9
+# define SSL_ENC_GOST89_IDX          10
+# define SSL_ENC_SEED_IDX            11
+# define SSL_ENC_AES128GCM_IDX       12
+# define SSL_ENC_AES256GCM_IDX       13
+# define SSL_ENC_AES128CCM_IDX       14
+# define SSL_ENC_AES256CCM_IDX       15
+# define SSL_ENC_AES128CCM8_IDX      16
+# define SSL_ENC_AES256CCM8_IDX      17
+# define SSL_ENC_GOST8912_IDX        18
+# define SSL_ENC_CHACHA_IDX          19
+# define SSL_ENC_ARIA128GCM_IDX      20
+# define SSL_ENC_ARIA256GCM_IDX      21
+# define SSL_ENC_MAGMA_IDX           22
+# define SSL_ENC_KUZNYECHIK_IDX      23
+# define SSL_ENC_MAGMA_MGM_IDX       24
+# define SSL_ENC_KUZNYECHIK_MGM_IDX  25
+# define SSL_ENC_NUM_IDX             26
 
 /*-
  * SSL_kRSA <- RSA_ENC
diff --git a/openssl/ssl/statem/statem_lib.c b/openssl/ssl/statem/statem_lib.c
index 65530df7a43..fa6eff459c4 100644
--- a/openssl/ssl/statem/statem_lib.c
+++ b/openssl/ssl/statem/statem_lib.c
@@ -502,10 +502,10 @@ MSG_PROCESS_RETURN tls_process_cert_verify(SSL_CONNECTION *s, PACKET *pkt)
 #ifndef OPENSSL_NO_GOST
     if (!SSL_USE_SIGALGS(s)
         && ((PACKET_remaining(pkt) == 64
-             && (EVP_PKEY_get_id(pkey) == NID_id_GostR3410_2001
-                 || EVP_PKEY_get_id(pkey) == NID_id_GostR3410_2012_256))
+             && (EVP_PKEY_is_a(pkey, SN_id_GostR3410_2001)
+                 || EVP_PKEY_is_a(pkey, SN_id_GostR3410_2012_256)))
             || (PACKET_remaining(pkt) == 128
-                && EVP_PKEY_get_id(pkey) == NID_id_GostR3410_2012_512))) {
+                && EVP_PKEY_is_a(pkey, SN_id_GostR3410_2012_512)))) {
         len = (unsigned int)PACKET_remaining(pkt);
     } else
 #endif
@@ -540,10 +540,9 @@ MSG_PROCESS_RETURN tls_process_cert_verify(SSL_CONNECTION *s, PACKET *pkt)
     }
 #ifndef OPENSSL_NO_GOST
     {
-        int pktype = EVP_PKEY_get_id(pkey);
-        if (pktype == NID_id_GostR3410_2001
-            || pktype == NID_id_GostR3410_2012_256
-            || pktype == NID_id_GostR3410_2012_512) {
+        if (EVP_PKEY_is_a(pkey, SN_id_GostR3410_2001)
+            || EVP_PKEY_is_a(pkey, SN_id_GostR3410_2012_256)
+            || EVP_PKEY_is_a(pkey, SN_id_GostR3410_2012_512)) {
             if ((gost_data = OPENSSL_malloc(len)) == NULL)
                 goto err;
             BUF_reverse(gost_data, data, len);
@@ -1947,8 +1946,6 @@ static int is_tls13_capable(const SSL_CONNECTION *s)
         switch (i) {
         case SSL_PKEY_DSA_SIGN:
         case SSL_PKEY_GOST01:
-        case SSL_PKEY_GOST12_256:
-        case SSL_PKEY_GOST12_512:
             continue;
         default:
             break;
@@ -1965,6 +1962,15 @@ static int is_tls13_capable(const SSL_CONNECTION *s)
         curve = ssl_get_EC_curve_nid(s->cert->pkeys[SSL_PKEY_ECC].privatekey);
         if (tls_check_sigalg_curve(s, curve))
             return 1;
+
+        /*
+         * TODO: There must be an opportunity to check that the sig algs are
+         * consistent with the keys in case if the sig algs are provider-based.
+         * For example, OSSL_FUNC_keymgmt_get_params could return the list of
+         * sig alg code points supported by the key, and this list could be
+         * checked against the sig algs code points stored in
+         * SSL_CTX.sigalg_lookup_cache
+         */
     }
 
     return 0;
diff --git a/openssl/ssl/t1_lib.c b/openssl/ssl/t1_lib.c
index 98fe2133817..3d5e85b22a7 100644
--- a/openssl/ssl/t1_lib.c
+++ b/openssl/ssl/t1_lib.c
@@ -2241,7 +2241,12 @@ int ssl_setup_sigalgs(SSL_CTX *ctx)
     /* Now complete cache and tls12_sigalgs list with provider sig information */
     cache_idx = OSSL_NELEM(sigalg_lookup_tbl);
     for (i = 0; i < ctx->sigalg_list_len; i++) {
+        size_t idx;
         TLS_SIGALG_INFO si = ctx->sigalg_list[i];
+
+        if (!ssl_cert_lookup_by_nid(OBJ_txt2nid(si.sigalg_name), &idx, ctx))
+            goto err;
+
         cache[cache_idx].name = si.name;
         cache[cache_idx].name12 = si.sigalg_name;
         cache[cache_idx].sigalg = si.code_point;
@@ -2249,7 +2254,7 @@ int ssl_setup_sigalgs(SSL_CTX *ctx)
         cache[cache_idx].hash = si.hash_name?OBJ_txt2nid(si.hash_name):NID_undef;
         cache[cache_idx].hash_idx = ssl_get_md_idx(cache[cache_idx].hash);
         cache[cache_idx].sig = OBJ_txt2nid(si.sigalg_name);
-        cache[cache_idx].sig_idx = (int)(i + SSL_PKEY_NUM);
+        cache[cache_idx].sig_idx = (int)idx;
         cache[cache_idx].sigandhash = OBJ_txt2nid(si.sigalg_name);
         cache[cache_idx].curve = NID_undef;
         cache[cache_idx].mintls = TLS1_3_VERSION;
@@ -3359,10 +3364,8 @@ static int tls12_sigalg_allowed(const SSL_CONNECTION *s, int op,
     if (ssl_cert_is_disabled(SSL_CONNECTION_GET_CTX(s), lu->sig_idx))
         return 0;
 
-    if (lu->sig == NID_id_GostR3410_2012_256
-            || lu->sig == NID_id_GostR3410_2012_512
-            || lu->sig == NID_id_GostR3410_2001) {
-        /* We never allow GOST sig algs on the server with TLSv1.3 */
+    if (lu->sig == NID_id_GostR3410_2001) {
+        /* We never allow GOST2001 sig algs on the server with TLSv1.3 */
         if (s->server && SSL_CONNECTION_IS_TLS13(s))
             return 0;
         if (!s->server
@@ -3398,6 +3401,18 @@ static int tls12_sigalg_allowed(const SSL_CONNECTION *s, int op,
         }
     }
 
+    /* TLS1.2 GOST sig algs could not be negotiated for the use in TLS1.3 */
+    if ((lu->sig == NID_id_GostR3410_2012_256 || lu->sig == NID_id_GostR3410_2012_512)
+        && (((s->server && SSL_CONNECTION_IS_TLS13(s)))
+            || (!s->server
+                && SSL_CONNECTION_GET_SSL(s)->method->version == TLS_ANY_VERSION
+                && s->s3.tmp.min_ver >= TLS1_3_VERSION))
+        && (strcmp(lu->name, TLSEXT_SIGALG_gostr34102012_256_intrinsic_name) == 0
+            || strcmp(lu->name, TLSEXT_SIGALG_gostr34102012_512_intrinsic_name) == 0
+            || strcmp(lu->name, TLSEXT_SIGALG_gostr34102012_256_gostr34112012_256_name) == 0
+            || strcmp(lu->name, TLSEXT_SIGALG_gostr34102012_512_gostr34112012_512_name) == 0))
+        return 0;
+
     /* Finally see if security callback allows it */
     secbits = sigalg_security_bits(SSL_CONNECTION_GET_CTX(s), lu);
     sigalgstr[0] = (lu->sigalg >> 8) & 0xff;
diff --git a/openssl/ssl/tls13_enc.c b/openssl/ssl/tls13_enc.c
index 489fafd5214..6ee2ab15ea3 100644
--- a/openssl/ssl/tls13_enc.c
+++ b/openssl/ssl/tls13_enc.c
@@ -391,26 +391,26 @@ static int derive_secret_key_and_iv(SSL_CONNECTION *s, const EVP_MD *md,
         *ivlen = *taglen = (size_t)mac_mdleni;
         *keylen = s->s3.tmp.new_mac_secret_size;
     } else {
+        uint32_t algenc;
 
         *keylen = EVP_CIPHER_get_key_length(ciph);
 
+        if (s->s3.tmp.new_cipher != NULL) {
+            algenc = s->s3.tmp.new_cipher->algorithm_enc;
+        } else if (s->session->cipher != NULL) {
+            /* We've not selected a cipher yet - we must be doing early data */
+            algenc = s->session->cipher->algorithm_enc;
+        } else if (s->psksession != NULL && s->psksession->cipher != NULL) {
+            /* We must be doing early data with out-of-band PSK */
+            algenc = s->psksession->cipher->algorithm_enc;
+        } else {
+            SSLfatal(s, SSL_AD_INTERNAL_ERROR, ERR_R_EVP_LIB);
+            return 0;
+        }
+
         mode = EVP_CIPHER_get_mode(ciph);
         if (mode == EVP_CIPH_CCM_MODE) {
-            uint32_t algenc;
-
             *ivlen = EVP_CCM_TLS_IV_LEN;
-            if (s->s3.tmp.new_cipher != NULL) {
-                algenc = s->s3.tmp.new_cipher->algorithm_enc;
-            } else if (s->session->cipher != NULL) {
-                /* We've not selected a cipher yet - we must be doing early data */
-                algenc = s->session->cipher->algorithm_enc;
-            } else if (s->psksession != NULL && s->psksession->cipher != NULL) {
-                /* We must be doing early data with out-of-band PSK */
-                algenc = s->psksession->cipher->algorithm_enc;
-            } else {
-                SSLfatal(s, SSL_AD_INTERNAL_ERROR, ERR_R_EVP_LIB);
-                return 0;
-            }
             if (algenc & (SSL_AES128CCM8 | SSL_AES256CCM8))
                 *taglen = EVP_CCM8_TLS_TAG_LEN;
             else
@@ -420,6 +420,12 @@ static int derive_secret_key_and_iv(SSL_CONNECTION *s, const EVP_MD *md,
 
             if (mode == EVP_CIPH_GCM_MODE) {
                 *taglen = EVP_GCM_TLS_TAG_LEN;
+#ifndef OPENSSL_NO_GOST
+            } else if (algenc & SSL_MAGMA_MGM) {
+                *taglen = EVP_MAGMA_TLS_TAG_LEN;
+            } else if (algenc & SSL_KUZNYECHIK_MGM) {
+                *taglen = EVP_KUZNYECHIK_TLS_TAG_LEN;
+#endif
             } else {
                 /* CHACHA20P-POLY1305 */
                 *taglen = EVP_CHACHAPOLY_TLS_TAG_LEN;
diff --git a/openssl/util/perl/OpenSSL/paramnames.pm b/openssl/util/perl/OpenSSL/paramnames.pm
index b9c53b0047f..a51afa5060a 100644
--- a/openssl/util/perl/OpenSSL/paramnames.pm
+++ b/openssl/util/perl/OpenSSL/paramnames.pm
@@ -154,6 +154,8 @@ my %params = (
     'OSSL_CIPHER_PARAM_XTS_STANDARD' =>         "xts_standard",# utf8_string
     'OSSL_CIPHER_PARAM_ENCRYPT_THEN_MAC' =>     "encrypt-then-mac",# int, 0 or 1
     'OSSL_CIPHER_HMAC_PARAM_MAC' =>             "*OSSL_CIPHER_PARAM_AEAD_TAG",
+    'OSSL_CIPHER_PARAM_TLSTREE' =>              "tlstree",             # octet_string
+    'OSSL_CIPHER_PARAM_TLSTREE_MODE' =>         "tlstree_mode",        # octet_string
 
     'OSSL_CIPHER_PARAM_TLS1_MULTIBLOCK_MAX_SEND_FRAGMENT' =>  "tls1multi_maxsndfrag",# uint
     'OSSL_CIPHER_PARAM_TLS1_MULTIBLOCK_MAX_BUFSIZE' =>        "tls1multi_maxbufsz",  # size_t
